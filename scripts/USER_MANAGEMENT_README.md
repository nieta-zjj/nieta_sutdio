# ç”¨æˆ·ç®¡ç†è„šæœ¬ä½¿ç”¨æŒ‡å—

æœ¬ç›®å½•åŒ…å«äº†å®Œæ•´çš„ç”¨æˆ·ç®¡ç†è„šæœ¬ï¼Œå¯ä»¥åˆ›å»ºæ–°ç”¨æˆ·å¹¶æŒ‡å®šç”¨æˆ·æƒé™ã€‚

## ğŸ“ æ–‡ä»¶è¯´æ˜

- `user_management.py` - ä¸»è¦çš„ç”¨æˆ·ç®¡ç†è„šæœ¬ï¼Œæä¾›å®Œæ•´çš„å‘½ä»¤è¡Œæ¥å£
- `create_user_example.py` - ç®€åŒ–çš„ç”¨æˆ·åˆ›å»ºç¤ºä¾‹è„šæœ¬ï¼Œæä¾›äº¤äº’å¼ç•Œé¢
- `USER_MANAGEMENT_README.md` - æœ¬è¯´æ˜æ–‡æ¡£

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ç¤ºä¾‹è„šæœ¬ï¼ˆæ¨èæ–°æ‰‹ï¼‰

```bash
# è¿è¡Œäº¤äº’å¼ç”¨æˆ·åˆ›å»ºå·¥å…·
python scripts/create_user_example.py
```

è¿™ä¸ªè„šæœ¬æä¾›äº†å‹å¥½çš„äº¤äº’ç•Œé¢ï¼Œå¯ä»¥ï¼š
1. åˆ›å»ºé¢„è®¾çš„ç¤ºä¾‹ç”¨æˆ·
2. äº¤äº’å¼åˆ›å»ºè‡ªå®šä¹‰ç”¨æˆ·
3. æŸ¥çœ‹å¯ç”¨è§’è‰²å’Œæƒé™

### æ–¹æ³•äºŒï¼šä½¿ç”¨å‘½ä»¤è¡Œè„šæœ¬ï¼ˆæ¨èé«˜çº§ç”¨æˆ·ï¼‰

```bash
# æŸ¥çœ‹å¸®åŠ©
python scripts/user_management.py --help

# æŸ¥çœ‹å¯ç”¨è§’è‰²å’Œæƒé™
python scripts/user_management.py roles
```

## ğŸ“‹ ç”¨æˆ·è§’è‰²ç³»ç»Ÿ

ç³»ç»Ÿé‡‡ç”¨åˆ†å±‚æƒé™æ¨¡å‹ï¼Œè§’è‰²ä¹‹é—´æœ‰ç»§æ‰¿å…³ç³»ï¼š

### è§’è‰²å±‚çº§ï¼ˆä»ä½åˆ°é«˜ï¼‰
1. **guest** - è®¿å®¢
2. **user** - æ™®é€šç”¨æˆ·
3. **pro_user** - é«˜çº§ç”¨æˆ·
4. **manager** - ç®¡ç†å‘˜
5. **admin** - è¶…çº§ç®¡ç†å‘˜

### æƒé™ç»§æ‰¿
- é«˜çº§è§’è‰²è‡ªåŠ¨ç»§æ‰¿ä½çº§è§’è‰²çš„æ‰€æœ‰æƒé™
- ç”¨æˆ·å¯ä»¥åŒæ—¶æ‹¥æœ‰å¤šä¸ªè§’è‰²
- æœ€ç»ˆæƒé™æ˜¯æ‰€æœ‰è§’è‰²æƒé™çš„å¹¶é›†

### æƒé™ç±»åˆ«
- **TEST** - æµ‹è¯•ç›¸å…³æƒé™
- **DATA** - æ•°æ®ç®¡ç†ç›¸å…³æƒé™
- **TRAIN** - è®­ç»ƒç›¸å…³æƒé™
- **GLOBAL** - å…¨å±€æƒé™

## ğŸ› ï¸ è¯¦ç»†ä½¿ç”¨æ–¹æ³•

### 1. åˆ›å»ºç”¨æˆ·

```bash
# åˆ›å»ºæ™®é€šç”¨æˆ·
python scripts/user_management.py create --username john --password john123 --roles user

# åˆ›å»ºç®¡ç†å‘˜
python scripts/user_management.py create --username admin --password admin123 --roles admin

# åˆ›å»ºå¤šè§’è‰²ç”¨æˆ·
python scripts/user_management.py create --username poweruser --password power123 --roles user pro_user
```

### 2. æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯

```bash
# æŸ¥çœ‹ç‰¹å®šç”¨æˆ·ä¿¡æ¯å’Œæƒé™
python scripts/user_management.py info --username john

# åˆ—å‡ºæ‰€æœ‰ç”¨æˆ·
python scripts/user_management.py list
```

### 3. æ›´æ–°ç”¨æˆ·è§’è‰²

```bash
# æ›´æ–°ç”¨æˆ·è§’è‰²
python scripts/user_management.py update --username john --roles pro_user manager
```

### 4. ç”¨æˆ·çŠ¶æ€ç®¡ç†

```bash
# æ¿€æ´»ç”¨æˆ·
python scripts/user_management.py activate --username john

# åœç”¨ç”¨æˆ·
python scripts/user_management.py deactivate --username john
```

### 5. æŸ¥çœ‹è§’è‰²å’Œæƒé™

```bash
# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨è§’è‰²å’Œå¯¹åº”æƒé™
python scripts/user_management.py roles
```

## ğŸ“Š ç¤ºä¾‹ç”¨æˆ·

è¿è¡Œç¤ºä¾‹è„šæœ¬ä¼šåˆ›å»ºä»¥ä¸‹æµ‹è¯•ç”¨æˆ·ï¼š

| ç”¨æˆ·å | å¯†ç  | è§’è‰² | è¯´æ˜ |
|--------|------|------|------|
| admin | admin123 | admin | è¶…çº§ç®¡ç†å‘˜ |
| manager | manager123 | manager | ç®¡ç†å‘˜ |
| pro_user | prouser123 | pro_user | é«˜çº§ç”¨æˆ· |
| normal_user | user123 | user | æ™®é€šç”¨æˆ· |
| guest_user | guest123 | guest | è®¿å®¢ç”¨æˆ· |
| multi_role_user | multi123 | user, pro_user | å¤šè§’è‰²ç”¨æˆ· |

## ğŸ”’ æƒé™è¯¦æƒ…

### GUEST æƒé™
- `test:view_results` - æŸ¥çœ‹æµ‹è¯•ç»“æœ
- `data:view_collection` - æŸ¥çœ‹æŒ‡å®šé›†åˆçš„å›¾ç‰‡
- `data:change_tags_viewable` - æ›´æ”¹å¯æŸ¥çœ‹å›¾ç‰‡çš„æ ‡ç­¾

### USER æƒé™ï¼ˆåŒ…å«GUESTæ‰€æœ‰æƒé™ï¼‰
- `test:create_low_priority` - åˆ›å»ºä½ä¼˜å…ˆçº§ä»»åŠ¡
- `test:delete_own` - åˆ é™¤è‡ªå·±çš„ä»»åŠ¡
- `data:view_all` - æŸ¥çœ‹æ‰€æœ‰å›¾ç‰‡
- `data:upload` - ä¸Šä¼ æ•°æ®
- `data:change_tags_any` - æ›´æ”¹ä»»ä½•å›¾ç‰‡çš„æ ‡ç­¾
- `train:start` - å¯åŠ¨è®­ç»ƒä»»åŠ¡
- `train:stop` - åœæ­¢è®­ç»ƒä»»åŠ¡

### PRO_USER æƒé™ï¼ˆåŒ…å«USERæ‰€æœ‰æƒé™ï¼‰
- `test:create_high_priority` - åˆ›å»ºé«˜ä¼˜å…ˆçº§ä»»åŠ¡
- `test:delete_any` - åˆ é™¤ä»»ä½•ä»»åŠ¡
- `data:auto_annotate` - æ‰§è¡Œè‡ªåŠ¨æ ‡æ³¨ä»»åŠ¡
- `train:batch_start` - æ‰¹é‡å¯åŠ¨è®­ç»ƒä»»åŠ¡

### MANAGER æƒé™ï¼ˆåŒ…å«PRO_USERæ‰€æœ‰æƒé™ï¼‰
- `data:delete` - åˆ é™¤æ•°æ®

### ADMIN æƒé™ï¼ˆåŒ…å«MANAGERæ‰€æœ‰æƒé™ï¼‰
- `global:create_user` - åˆ›å»ºç”¨æˆ·
- `global:assign_permissions` - åˆ†é…æƒé™

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ•°æ®åº“è¿æ¥**ï¼šè„šæœ¬ä¼šè‡ªåŠ¨è¿æ¥åˆ°é…ç½®çš„æ•°æ®åº“ï¼Œç¡®ä¿æ•°æ®åº“æœåŠ¡æ­£åœ¨è¿è¡Œ
2. **å¯†ç å®‰å…¨**ï¼šå¯†ç ä¼šè‡ªåŠ¨ä½¿ç”¨bcryptè¿›è¡Œå“ˆå¸ŒåŠ å¯†å­˜å‚¨
3. **è§’è‰²éªŒè¯**ï¼šåˆ›å»ºç”¨æˆ·æ—¶ä¼šéªŒè¯è§’è‰²çš„æœ‰æ•ˆæ€§
4. **ç”¨æˆ·åå”¯ä¸€æ€§**ï¼šç”¨æˆ·åå¿…é¡»å”¯ä¸€ï¼Œä¸èƒ½é‡å¤
5. **æƒé™ç»§æ‰¿**ï¼šç†è§£è§’è‰²ç»§æ‰¿å…³ç³»ï¼Œé¿å…åˆ†é…å†—ä½™æƒé™

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é”™è¯¯

1. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```
   âŒ æ•°æ®åº“è¿æ¥å¤±è´¥: connection refused
   ```
   - æ£€æŸ¥æ•°æ®åº“æœåŠ¡æ˜¯å¦å¯åŠ¨
   - éªŒè¯æ•°æ®åº“é…ç½®ä¿¡æ¯

2. **ç”¨æˆ·åå·²å­˜åœ¨**
   ```
   âŒ ç”¨æˆ·å 'john' å·²å­˜åœ¨
   ```
   - ä½¿ç”¨ä¸åŒçš„ç”¨æˆ·å
   - æˆ–è€…æ›´æ–°ç°æœ‰ç”¨æˆ·çš„è§’è‰²

3. **æ— æ•ˆè§’è‰²**
   ```
   âŒ æ— æ•ˆçš„è§’è‰²: ['invalid_role']
   ```
   - ä½¿ç”¨ `python scripts/user_management.py roles` æŸ¥çœ‹å¯ç”¨è§’è‰²
   - æ£€æŸ¥è§’è‰²åç§°æ‹¼å†™

### è·å–å¸®åŠ©

```bash
# æŸ¥çœ‹ä¸»è„šæœ¬å¸®åŠ©
python scripts/user_management.py --help

# æŸ¥çœ‹ç‰¹å®šå‘½ä»¤å¸®åŠ©
python scripts/user_management.py create --help
```

## ğŸ”§ å¼€å‘è¯´æ˜

å¦‚éœ€æ‰©å±•ç”¨æˆ·ç®¡ç†åŠŸèƒ½ï¼š

1. **æ·»åŠ æ–°è§’è‰²**ï¼šåœ¨ `backend/models/db/user.py` ä¸­çš„ `Role` æšä¸¾æ·»åŠ æ–°è§’è‰²
2. **æ·»åŠ æ–°æƒé™**ï¼šåœ¨ `Permission` æšä¸¾ä¸­æ·»åŠ æ–°æƒé™
3. **é…ç½®æƒé™æ˜ å°„**ï¼šåœ¨ `ROLE_ADDITIONAL_PERMISSIONS` ä¸­é…ç½®è§’è‰²æƒé™å…³ç³»
4. **æ›´æ–°ç»§æ‰¿å…³ç³»**ï¼šåœ¨ `ROLE_HIERARCHY` ä¸­é…ç½®è§’è‰²ç»§æ‰¿å…³ç³»

## ğŸ“ æ›´æ–°æ—¥å¿—

- v1.0.0 - åˆå§‹ç‰ˆæœ¬ï¼Œæ”¯æŒåŸºæœ¬çš„ç”¨æˆ·CRUDæ“ä½œ
- æ”¯æŒè§’è‰²æƒé™ç³»ç»Ÿ
- æä¾›å‘½ä»¤è¡Œå’Œäº¤äº’å¼ä¸¤ç§ä½¿ç”¨æ–¹å¼